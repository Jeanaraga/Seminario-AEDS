CC = g++
CFLAGS = -Wall -O2 -std=c++11

# Diret√≥rios exatos da sua estrutura
STRUCT_DIRS = FilaDinamica FilaEstatica ListaDinamica ListaEstatica PilhaDinamica PilhaEstatica

# Lista expl√≠cita dos execut√°veis esperados
EXECUTAVEIS = shellsort_FilaDinamica shellsort_FilaEstatica shellsort_ListaDinamica shellsort_ListaEstatica shellsort_PilhaDinamica shellsort_PilhaEstatica

all: $(EXECUTAVEIS)

# Regra gen√©rica para todos os shellsort_*
shellsort_%: %/shellsort_%.cpp
	@echo "üî® Compilando $@..."
	@if [ -f "$<" ]; then \
		$(CC) $(CFLAGS) -I$* -o $@ $< && echo "‚úÖ $@ compilado com sucesso!" || echo "‚ùå Erro ao compilar $@"; \
	else \
		echo "‚ùå Arquivo $< n√£o encontrado!"; \
		exit 1; \
	fi

# Regras espec√≠ficas como backup (caso a gen√©rica n√£o funcione)
shellsort_FilaEstatica: FilaEstatica/shellsort_FilaEstatica.cpp
	@echo "üî® Compilando $@..."
	$(CC) $(CFLAGS) -IFilaEstatica -o $@ $<

shellsort_FilaDinamica: FilaDinamica/shellsort_FilaDinamica.cpp
	@echo "üî® Compilando $@..."
	$(CC) $(CFLAGS) -IFilaDinamica -o $@ $<

shellsort_ListaEstatica: ListaEstatica/shellsort_ListaEstatica.cpp
	@echo "üî® Compilando $@..."
	$(CC) $(CFLAGS) -IListaEstatica -o $@ $<

shellsort_ListaDinamica: ListaDinamica/shellsort_ListaDinamica.cpp
	@echo "üî® Compilando $@..."
	$(CC) $(CFLAGS) -IListaDinamica -o $@ $<

shellsort_PilhaEstatica: PilhaEstatica/shellsort_PilhaEstatica.cpp
	@echo "üî® Compilando $@..."
	$(CC) $(CFLAGS) -IPilhaEstatica -o $@ $<

shellsort_PilhaDinamica: PilhaDinamica/shellsort_PilhaDinamica.cpp
	@echo "üî® Compilando $@..."
	$(CC) $(CFLAGS) -IPilhaDinamica -o $@ $<

run: all
	@echo ""
	@echo "üìä Resultados de tempo de execu√ß√£o:"
	@for exe in $(EXECUTAVEIS); do \
		if [ -f "./$$exe" ]; then \
			echo ""; \
			echo "üèÉ Executando $$exe..."; \
			START=$$(date +%s.%N); \
			./$$exe 2>&1; \
			END=$$(date +%s.%N); \
			if command -v bc >/dev/null 2>&1; then \
				TIME=$$(echo "scale=10; $$END - $$START" | bc 2>/dev/null); \
				if [ ! -z "$$TIME" ]; then \
					printf "‚è± Tempo total (real): %.6f segundos\n" "$$TIME"; \
				fi; \
			fi; \
		else \
			echo "‚ùå $$exe n√£o foi compilado"; \
		fi; \
	done

clean:
	@echo "üßπ Limpando execut√°veis..."
	@rm -f $(EXECUTAVEIS)
	@echo "‚úÖ Limpeza conclu√≠da!"

# Compilar apenas um espec√≠fico
compile-one:
	@echo "Digite o nome (ex: FilaEstatica):"
	@read nome; \
	if [ -f "$$nome/shellsort_$$nome.cpp" ]; then \
		echo "üî® Compilando shellsort_$$nome..."; \
		$(CC) $(CFLAGS) -I$$nome -o shellsort_$$nome $$nome/shellsort_$$nome.cpp && \
		echo "‚úÖ Compilado com sucesso!" || echo "‚ùå Erro na compila√ß√£o"; \
	else \
		echo "‚ùå Arquivo $$nome/shellsort_$$nome.cpp n√£o encontrado"; \
	fi

test-all:
	@echo "üß™ Testando compila√ß√£o individual:"
	@for dir in $(STRUCT_DIRS); do \
		echo ""; \
		echo "üìÅ Testando $$dir..."; \
		if [ -f "$$dir/shellsort_$$dir.cpp" ]; then \
			$(CC) $(CFLAGS) -I$$dir -o test_$$dir $$dir/shellsort_$$dir.cpp 2>&1 && \
			echo "‚úÖ $$dir: OK" || echo "‚ùå $$dir: ERRO"; \
			rm -f test_$$dir; \
		else \
			echo "‚ùå $$dir: Arquivo n√£o encontrado"; \
		fi; \
	done

debug:
	@echo "üîç Informa√ß√µes de Debug:"
	@echo "EXECUTAVEIS: $(EXECUTAVEIS)"
	@echo ""
	@for dir in $(STRUCT_DIRS); do \
		echo "üìÅ $$dir:"; \
		if [ -f "$$dir/shellsort_$$dir.cpp" ]; then \
			echo "  ‚úÖ shellsort_$$dir.cpp"; \
		else \
			echo "  ‚ùå shellsort_$$dir.cpp n√£o encontrado"; \
		fi; \
		if [ -f "$$dir/shellsort_$$dir.hpp" ]; then \
			echo "  ‚úÖ shellsort_$$dir.hpp"; \
		else \
			echo "  ‚ùå shellsort_$$dir.hpp n√£o encontrado"; \
		fi; \
	done

.PHONY: all run clean compile-one test-all debug
